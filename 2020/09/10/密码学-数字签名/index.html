<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <link rel="manifest" href="/images/site.webmanifest">
  <meta name="msapplication-config" content="/images/browserconfig.xml">
  <meta name="msvalidate.01" content="<meta name="msvalidate.01" content="5D3796A5DDB32CC875380613FB613833" />">
  <meta name="baidu-site-verification" content="<meta name="baidu-site-verification" content="kewHZtFYQk" />">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Helvetica:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/lib/animate-css/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-flat-top.min.css">
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"lyf35.github.io","root":"/","scheme":"Pisces","version":"8.0.0-rc.5","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":true,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":{"gitalk":{"order":-2}},"activeClass":"gitalk"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"path":"search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="Overview Introduction Signature schemes allow a signer \(S\) who has established a public key \(pk\) to &quot;sign&quot; a message using the associated private key \(sk\) in such a way that anyone who knows \(p">
<meta property="og:type" content="article">
<meta property="og:title" content="密码学-数字签名">
<meta property="og:url" content="http://lyf35.github.io/2020/09/10/%E5%AF%86%E7%A0%81%E5%AD%A6-%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/index.html">
<meta property="og:site_name" content="Yufei Luo&#39;s Blog">
<meta property="og:description" content="Overview Introduction Signature schemes allow a signer \(S\) who has established a public key \(pk\) to &quot;sign&quot; a message using the associated private key \(sk\) in such a way that anyone who knows \(p">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/lyf35/blog_figures/main/img/20201105002941.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyf35/blog_figures/main/img/20201105002938.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyf35/blog_figures/main/img/20201105002930.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyf35/blog_figures/main/img/20201105002923.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lyf35/blog_figures/main/img/20201105002916.png">
<meta property="article:published_time" content="2020-09-10T12:43:01.000Z">
<meta property="article:modified_time" content="2020-10-19T12:21:52.000Z">
<meta property="article:author" content="Yufei Luo">
<meta property="article:tag" content="信息安全">
<meta property="article:tag" content="密码学">
<meta property="article:tag" content="计算机基础">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/lyf35/blog_figures/main/img/20201105002941.png">

<link rel="canonical" href="http://lyf35.github.io/2020/09/10/%E5%AF%86%E7%A0%81%E5%AD%A6-%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/">


<script data-pjax class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>密码学-数字签名 | Yufei Luo's Blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
 <!--   <div class="headband"></div>-->

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Yufei Luo's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">But I was so much older then, I am younger than that now.</p>
      <img class="custom-logo-image" src="/images/logo.png" alt="Yufei Luo's Blog">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-计算机基础">

    <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80" rel="section"><i class="fa fa-tags fa-fw"></i>计算机基础</a>

  </li>
        <li class="menu-item menu-item-机器学习">

    <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0" rel="section"><i class="fa fa-tags fa-fw"></i>机器学习</a>

  </li>
        <li class="menu-item menu-item-深度学习">

    <a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0" rel="section"><i class="fa fa-tags fa-fw"></i>深度学习</a>

  </li>
        <li class="menu-item menu-item-工程实践">

    <a href="/categories/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5" rel="section"><i class="fa fa-tags fa-fw"></i>工程实践</a>

  </li>
        <li class="menu-item menu-item-论文笔记">

    <a href="/categories/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0" rel="section"><i class="fa fa-tags fa-fw"></i>论文笔记</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#overview"><span class="nav-number">1.</span> <span class="nav-text">Overview</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#introduction"><span class="nav-number">1.1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#definitions"><span class="nav-number">1.2.</span> <span class="nav-text">Definitions</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#the-hash-and-sign-paradigm"><span class="nav-number">2.</span> <span class="nav-text">The Hash-and-Sign paradigm</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#rsa-signatures"><span class="nav-number">3.</span> <span class="nav-text">RSA signatures</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#plain-rsa"><span class="nav-number">3.1.</span> <span class="nav-text">Plain RSA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rsa-fdh-and-pkcs-1-v2.1"><span class="nav-number">3.2.</span> <span class="nav-text">RSA-FDH and PKCS #1 v2.1</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#signatures-from-the-discrete-logarithm-problem"><span class="nav-number">4.</span> <span class="nav-text">Signatures from the Discrete-Logarithm problem</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#the-schnorr-signature-scheme"><span class="nav-number">4.1.</span> <span class="nav-text">The Schnorr signature scheme</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#three-round-identification-scheme"><span class="nav-number">4.1.1.</span> <span class="nav-text">Three-round identification scheme</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fiat-shamir-transform"><span class="nav-number">4.1.2.</span> <span class="nav-text">Fiat-Shamir transform</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#schnorr-identification-scheme"><span class="nav-number">4.1.3.</span> <span class="nav-text">Schnorr identification scheme</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dsa-and-ecdsa"><span class="nav-number">4.2.</span> <span class="nav-text">DSA and ECDSA</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#certificates-and-public-key-infrastructures"><span class="nav-number">5.</span> <span class="nav-text">Certificates and public-key infrastructures</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#certificates"><span class="nav-number">5.1.</span> <span class="nav-text">Certificates</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#definition"><span class="nav-number">5.1.1.</span> <span class="nav-text">Definition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#details-of-a-certificate"><span class="nav-number">5.1.2.</span> <span class="nav-text">Details of a certificate</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#public-key-infrastructure-pki"><span class="nav-number">5.2.</span> <span class="nav-text">Public-key infrastructure (PKI)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#types"><span class="nav-number">5.2.1.</span> <span class="nav-text">Types</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pki-in-practice"><span class="nav-number">5.2.2.</span> <span class="nav-text">PKI in practice</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#invalidating-certificates"><span class="nav-number">5.3.</span> <span class="nav-text">Invalidating certificates</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ssltls"><span class="nav-number">6.</span> <span class="nav-text">SSL&#x2F;TLS</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#overview-1"><span class="nav-number">6.1.</span> <span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#the-hand-shake-protocol"><span class="nav-number">6.2.</span> <span class="nav-text">The hand-shake protocol</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#the-record-layer-protocol"><span class="nav-number">6.3.</span> <span class="nav-text">The record-layer protocol</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pseudocode"><span class="nav-number">6.4.</span> <span class="nav-text">Pseudocode</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#client"><span class="nav-number">6.4.1.</span> <span class="nav-text">Client</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#server"><span class="nav-number">6.4.2.</span> <span class="nav-text">Server</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#references"><span class="nav-number">7.</span> <span class="nav-text">References</span></a></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Yufei Luo"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">Yufei Luo</p>
  <div class="site-description" itemprop="description">哪怕什么真理无穷，进一寸有进一寸的欢喜</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
        
          <span class="site-state-item-count">90</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags">
          
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2x5ZjM1" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;lyf35"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOmx5ZjEyMzQwMDAwMDBAMTYzLmNvbQ==" title="E-Mail → mailto:lyf1234000000@163.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span>
  </div>



      </section>
        <div class="back-to-top animated">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="reading-progress-bar"></div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL2x5ZjM1" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lyf35.github.io/2020/09/10/%E5%AF%86%E7%A0%81%E5%AD%A6-%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Yufei Luo">
      <meta itemprop="description" content="哪怕什么真理无穷，进一寸有进一寸的欢喜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yufei Luo's Blog">
    </span>

    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          密码学-数字签名
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-10 20:43:01" itemprop="dateCreated datePublished" datetime="2020-09-10T20:43:01+08:00">2020-09-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-19 20:21:52" itemprop="dateModified" datetime="2020-10-19T20:21:52+08:00">2020-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">理论知识</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">信息安全</span></a>
                </span>
            </span>

          
            <span id="/2020/09/10/%E5%AF%86%E7%A0%81%E5%AD%A6-%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/" class="post-meta-item leancloud_visitors" data-flag-title="密码学-数字签名" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>22k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>20 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="overview">Overview</h1>
<h2 id="introduction">Introduction</h2>
<p>Signature schemes allow a signer <span class="math inline">\(S\)</span> who has established a public key <span class="math inline">\(pk\)</span> to "sign" a message using the associated private key <span class="math inline">\(sk\)</span> in such a way that anyone who knows <span class="math inline">\(pk\)</span> (and knows that this public key was established by <span class="math inline">\(S\)</span>) can verify that the message originated from <span class="math inline">\(S\)</span> and was not modified in transit. (Note that the owner of the public key behaves as the sender, which is in contrast to the public-key encryption) <span id="more"></span></p>
<p>Comparison to MAC:</p>
<ul>
<li>Signatures are publicly verifiable: one receiver verifies a signature <span class="math inline">\(\sigma\)</span> on a given message <span class="math inline">\(m\)</span> means all other parties will also verify it as legitimate.</li>
<li>Signatures are transferable: a signature <span class="math inline">\(\sigma\)</span> on a message <span class="math inline">\(m\)</span> by a signer <span class="math inline">\(S\)</span> can be shown to a third party.</li>
<li>Signatures provide non-repudiation: once <span class="math inline">\(S\)</span> signs a message, the signer cannot later deny having done so. But MAC cannot provide that property.</li>
<li>Signatures are much slower: MAC is roughly 2-3 orders of magnitude more efficient than digital signatures.</li>
</ul>
<h2 id="definitions">Definitions</h2>
<p>A digital signature scheme consists of three probabilistic polynomial-time algorithms <span class="math inline">\((Gen,Sign,Vrfy)\)</span> such that:</p>
<ul>
<li>The key-generation algorithm <span class="math inline">\(Gen\)</span> takes as input a security parameter <span class="math inline">\(1^n\)</span> and outputs a pair of keys <span class="math inline">\((pk,sk)\)</span>. These are called the public key and the private key, respectively. We assume that pk and sk each has length at least <span class="math inline">\(n\)</span>, and <span class="math inline">\(n\)</span> can be determined from <span class="math inline">\(pk\)</span> or <span class="math inline">\(sk\)</span>.</li>
<li>The signing algorithm <span class="math inline">\(Sign\)</span> takes as input a private key <span class="math inline">\(sk\)</span> and a message <span class="math inline">\(m\)</span> for some message space. It outputs a signature <span class="math inline">\(\sigma\)</span>, and we write this as <span class="math inline">\(\sigma\leftarrow Sign_{sk}(m)\)</span>.</li>
<li>The deterministic verification algorithm <span class="math inline">\(Vrfy\)</span> takes as input a public key <span class="math inline">\(pk\)</span>, a message <span class="math inline">\(m\)</span> and a signature <span class="math inline">\(\sigma\)</span>. It outputs a bit <span class="math inline">\(b\)</span>, with <span class="math inline">\(b=1\)</span> meaning valid and <span class="math inline">\(b=0\)</span> meaning invalid. We write this as <span class="math inline">\(b:=Vrfy_{pk}(m,\sigma)\)</span>.</li>
</ul>
<p>It is required that except with negligible probability over <span class="math inline">\((pk,sk)\)</span> output by <span class="math inline">\(Gen(1^{n})\)</span>, it holds that <span class="math inline">\(Vrfy_{pk}(m,Sign_{sk}(m))=1\)</span> for every legal message <span class="math inline">\(m\)</span>.</p>
<h1 id="the-hash-and-sign-paradigm">The Hash-and-Sign paradigm</h1>
<p>Similar with hybrid encryption, it is possible to obtain the functionality of digital signatures at the symptotic cost of a private-key operation, at least for sufficient long messages. This can be done using the hash-and-sign approach.</p>
<p>Let <span class="math inline">\(\Pi=(Gen,Sign,Vrfy)\)</span> be a signature scheme for messages of length <span class="math inline">\(\ell(n)\)</span>, and let <span class="math inline">\(\Pi_{H}=(Gen_{H},H)\)</span> be a hash function with output length <span class="math inline">\(\ell(n)\)</span>. Construct signature scheme <span class="math inline">\(\Pi&#39;=(Gen&#39;,Sign&#39;,Vrfy&#39;)\)</span> as follows:</p>
<ul>
<li><span class="math inline">\(Gen&#39;\)</span>: on input <span class="math inline">\(1^n\)</span>, run <span class="math inline">\(Gen(1^{n})\)</span> to obtain <span class="math inline">\((pk,sk)\)</span> and run <span class="math inline">\(Gen_{H}(1^{n})\)</span> to obtain <span class="math inline">\(s\)</span>; the public key is <span class="math inline">\(&lt;pk,s&gt;\)</span> and the private key is <span class="math inline">\(&lt;sk,s&gt;\)</span>.</li>
<li><span class="math inline">\(Sign&#39;\)</span>: on input a private key <span class="math inline">\(&lt;sk,s&gt;\)</span> and a message <span class="math inline">\(m\in \{0,1\}^*\)</span>, output <span class="math inline">\(\sigma \leftarrow Sign_{sk}(H^{s}(m))\)</span>.</li>
<li><span class="math inline">\(Vrfy&#39;\)</span>: on input a public key <span class="math inline">\(&lt;pk,s&gt;\)</span>, a message <span class="math inline">\(m\in\{0,1\}^*\)</span>, and a signature <span class="math inline">\(\sigma\)</span>, output 1 if and only if <span class="math inline">\(Vrfy_{pk}(H^{s}(m),\sigma)=1\)</span>.</li>
</ul>
<p>If <span class="math inline">\(\Pi\)</span> is a secure signature scheme for messages of length <span class="math inline">\(\ell\)</span> and <span class="math inline">\(\Pi_{H}\)</span> is collision resistant, then the above construction is a secure signature scheme (for arbitrary-length messages).</p>
<h1 id="rsa-signatures">RSA signatures</h1>
<h2 id="plain-rsa">Plain RSA</h2>
<p>Let <span class="math inline">\(GenRSA\)</span> be as in the text. Define the plain RSA signature scheme as follows:</p>
<ul>
<li><span class="math inline">\(Gen\)</span>: on input <span class="math inline">\(1^n\)</span> run <span class="math inline">\(GenRSA(1^{n})\)</span> to obtain <span class="math inline">\(&lt;N,e,d&gt;\)</span>. The public key is <span class="math inline">\(&lt;N,e&gt;\)</span> and the private key is <span class="math inline">\(&lt;N,d&gt;\)</span>.</li>
<li><span class="math inline">\(Sign\)</span>: on input a private key $ sk=&lt;N,d&gt;$ and a message <span class="math inline">\(m\in \mathbb{Z}_{N}^{*}\)</span>, compute the signature <span class="math inline">\(\sigma:=[m^{d}~mod~N]\)</span>.</li>
<li><span class="math inline">\(Vrfy\)</span>: on input a public key <span class="math inline">\(pk=&lt;N,e&gt;\)</span>, a message <span class="math inline">\(m\in \mathbb{Z}_{N}^{*}\)</span>, and a signature <span class="math inline">\(\sigma\in \mathbb{Z}_{N}^{*}\)</span>, output 1 if and only if <span class="math inline">\(m=[\sigma ^{e}~mod~N]\)</span>.</li>
</ul>
<p>The plain RSA signature scheme is vulnerable to the following two types of attack:</p>
<ol type="1">
<li>No-message attack: the forgery use the public key alone, without obtaining any signatures from the legitimate signer. The attacker choose a uniform <span class="math inline">\(\sigma \in \mathbb{Z}_{N}^{*}\)</span> and compute <span class="math inline">\(m:=[\sigma ^{e}~mod~N]\)</span>. Then output the forgery <span class="math inline">\((m,\sigma)\)</span>.</li>
<li>Forging a signature on an arbitrary message: when the adversary can obtain two signatures from the signer, the signature <span class="math inline">\(\sigma:=[\sigma_{1}\cdot \sigma_{2}~mod~N]\)</span> is a valid on message <span class="math inline">\(m=m_{1}\cdot m_{2}~mod~N\)</span>.</li>
</ol>
<h2 id="rsa-fdh-and-pkcs-1-v2.1">RSA-FDH and PKCS #1 v2.1</h2>
<p>Let <span class="math inline">\(GenRSA\)</span> be as in the text. Construct the RSA-FDH signature scheme as follows:</p>
<ul>
<li><span class="math inline">\(Gen\)</span>: on input <span class="math inline">\(1^n\)</span> run <span class="math inline">\(GenRSA(1^{n})\)</span> to obtain <span class="math inline">\(&lt;N,e,d&gt;\)</span>. The public key is <span class="math inline">\(&lt;N,e&gt;\)</span> and the private key is <span class="math inline">\(&lt;N,d&gt;\)</span>. Also, a key is generated to specify a function <span class="math inline">\(H:\{0,1\}^{*}\rightarrow \mathbb{Z}_{N}^{*}\)</span>.</li>
<li><span class="math inline">\(Sign\)</span>: on input a private key <span class="math inline">\(sk=&lt;N,d&gt;\)</span> and a message <span class="math inline">\(m\in \mathbb{Z}_{N}^{*}\)</span>, compute the signature <span class="math inline">\(\sigma:=[H(m)^{d}~mod~N]\)</span>.</li>
<li><span class="math inline">\(Vrfy\)</span>: on input a public key <span class="math inline">\(pk=&lt;N,e&gt;\)</span>, a message <span class="math inline">\(m\in \mathbb{Z}_{N}^{*}\)</span>, and a signature <span class="math inline">\(\sigma\in \mathbb{Z}_{N}^{*}\)</span>, output 1 if and only if <span class="math inline">\(\sigma^{e}=[H(m)~mod~N]\)</span>.</li>
</ul>
<p>The hash function should satisfy that:</p>
<ul>
<li><span class="math inline">\(H\)</span> should be hard to invert.</li>
<li><span class="math inline">\(H\)</span> does not admit multiplicative relations.</li>
<li>It is hard to find collisions in <span class="math inline">\(H\)</span>.</li>
</ul>
<p>There is no known way to choose <span class="math inline">\(H\)</span> so that the above construction can be proven secure. But it is possible to prove security if <span class="math inline">\(H\)</span> is modeled as a random oracle that maps its inputs uniformly onto <span class="math inline">\(\mathbb{Z}_{N}^{*}\)</span>. The scheme in this case is called the RSA full-domain hash (RSA-FDH) signature scheme.</p>
<p>The RSA PKCS #1 v2.1 standard includes a signature scheme that can be viewed as a variant of RSA-FDH. The standard defines a scheme in which the signature on a message depends on a <strong>salt</strong> (i.e., a random value) chosen by the signer at the time of signature generation.</p>
<h1 id="signatures-from-the-discrete-logarithm-problem">Signatures from the Discrete-Logarithm problem</h1>
<h2 id="the-schnorr-signature-scheme">The Schnorr signature scheme</h2>
<p>An <strong>identification scheme</strong> is an interactive protocol that allows one party to prove its identity (i.e., to authenticate itself) to another.</p>
<p>The party identifying herself is called the "prover", and the party verifying the identity is called the "verifier". Successful execution of the identification protocol convinces the verifier that it is communicating with the intended prover rather than an imposter.</p>
<h3 id="three-round-identification-scheme">Three-round identification scheme</h3>
<p>A <strong>three-round identification scheme</strong> is shown as the following figure. <span class="math inline">\(\mathcal{P}_{1}\)</span>, <span class="math inline">\(\mathcal{P}_{2}\)</span> are two algorithms used by the prover and <span class="math inline">\(\mathcal{V}\)</span> is the algorithm used at the verifier's side. <span class="math inline">\(\Omega_{pk}\)</span> is a set defined by the prover's public key <span class="math inline">\(pk\)</span>.</p>
<p><img data-src="https://raw.githubusercontent.com/lyf35/blog_figures/main/img/20201105002941.png" alt="image-20201019234646133" style="zoom: 33%;" /></p>
<h3 id="fiat-shamir-transform">Fiat-Shamir transform</h3>
<p>The <strong>Fiat-Shamir transform</strong> provides a way to convert any interactive identification scheme into a non-interactive signature scheme. The basic idea is for the signer to act as a prover, running the identification protocol by itself.</p>
<p>Let <span class="math inline">\((Gen_{id},\mathcal{P}_{1},\mathcal{P}_{2},\mathcal{V})\)</span> be an identification scheme, construct a signature scheme as follows:</p>
<ul>
<li><span class="math inline">\(Gen\)</span>: on input <span class="math inline">\(1^n\)</span>, simply run <span class="math inline">\(Gen_{id}(1^{n})\)</span> to obtain keys <span class="math inline">\(pk,sk\)</span>.</li>
<li><span class="math inline">\(Sign\)</span>: on input a private key <span class="math inline">\(sk\)</span> and a message <span class="math inline">\(m\in \{0,1\}^{*}\)</span>, do:
<ol type="1">
<li>Compute <span class="math inline">\((I,st)\leftarrow \mathcal{P}_{1}(sk)\)</span>.</li>
<li>Compute <span class="math inline">\(r:=H(I,m)\)</span>.</li>
<li>Compute <span class="math inline">\(s:=\mathcal{P}_{2}(sk,st,r)\)</span>.</li>
<li>Output the signature <span class="math inline">\((r,s)\)</span>.</li>
</ol></li>
<li><span class="math inline">\(Vrfy\)</span>: on input a public key <span class="math inline">\(pk\)</span>, a message <span class="math inline">\(m\)</span>, and a signature <span class="math inline">\((r,s)\)</span>, compute <span class="math inline">\(I:=\mathcal{V}(pk,r,s)\)</span> and output 1 if and only if <span class="math inline">\(H(I,m)=r\)</span>.</li>
</ul>
<p>Let <span class="math inline">\(\Pi\)</span> be an identification scheme, and let <span class="math inline">\(\Pi&#39;\)</span> be the signature scheme that results by applying the Fiat-Shamir transform to it. If <span class="math inline">\(\Pi\)</span> is secure and <span class="math inline">\(H\)</span> is modeled as a random oracle, then <span class="math inline">\(\Pi&#39;\)</span> is secure.</p>
<h3 id="schnorr-identification-scheme">Schnorr identification scheme</h3>
<p>The <strong>Schnorr identification scheme</strong> is based on hardness of the discrete-logarithm problem. An execution of the Schnorr identification scheme is shown as the following figure. Note that the cyclic group <span class="math inline">\(\mathbb{G}\)</span>, its order <span class="math inline">\(q\)</span> and a generator <span class="math inline">\(g\)</span> are generated by a polynomial-time algorithm <span class="math inline">\(\mathcal{G}\)</span>.</p>
<p><img data-src="https://raw.githubusercontent.com/lyf35/blog_figures/main/img/20201105002938.png" alt="image-20201019234955220" style="zoom: 50%;" /></p>
<p>If the discrete-logarithm problem is hard relative to <span class="math inline">\(\mathcal{G}\)</span>, then the Schnorr identification scheme is secure.</p>
<p>By applying the Fiat-Shamir transform to the Schnorr identification scheme, the Schnorr signature scheme is obtained as follows:</p>
<ul>
<li><span class="math inline">\(Gen\)</span>: run <span class="math inline">\(\mathcal{G}(1^{n})\)</span> to obtain <span class="math inline">\((\mathbb{G},q,g)\)</span>. Choose a uniform <span class="math inline">\(x\in \mathbb{Z}_q\)</span> and set <span class="math inline">\(y:=g^x\)</span>. The private key is <span class="math inline">\(x\)</span> and the public key is <span class="math inline">\((\mathbb{G},q,g,y)\)</span>. Also, generate a key to specify a function <span class="math inline">\(H:\{0,1\}^{*}\rightarrow \mathbb{Z}_{q}\)</span>.</li>
<li><span class="math inline">\(Sign\)</span>: on input a private key <span class="math inline">\(x\)</span> and a message <span class="math inline">\(m\in \{0,1\}^*\)</span>, choose uniform <span class="math inline">\(k\in \mathbb{Z}_q\)</span> and set <span class="math inline">\(I:=g^k\)</span>. Then compute <span class="math inline">\(r:=H(I,m)\)</span>, followed by <span class="math inline">\(s:=[rx+k~mod~q]\)</span>. Output the signature <span class="math inline">\((r,s)\)</span>.</li>
<li><span class="math inline">\(Vrfy\)</span>: on input a public key <span class="math inline">\((\mathbb{G},q,g,y)\)</span>, a message <span class="math inline">\(m\)</span>, and a signature <span class="math inline">\((r,s)\)</span>, compute <span class="math inline">\(I:=g^{s}\cdot y^{-r}\)</span> and output 1 if <span class="math inline">\(H(I,m)=r\)</span>.</li>
</ul>
<h2 id="dsa-and-ecdsa">DSA and ECDSA</h2>
<p>The <strong>Digital Signature Algorithm</strong> (DSA) and <strong>Elliptic Curve Digital Signature Algorithm</strong> (ECDSA) are based on the discrete-logarithm problem in different classes of groups. They are both included in the current Digital Signature Standard (DSS) issued by NIST.</p>
<p>Let <span class="math inline">\(\mathbb{G}\)</span> be a cyclic group of prime order <span class="math inline">\(q\)</span> with generator <span class="math inline">\(g\)</span>, both schemes can be seen as constructing from the following identification scheme:</p>
<ul>
<li>The prover chooses uniform <span class="math inline">\(k\in \mathbb{Z}_{q}^{*}\)</span> and sends <span class="math inline">\(I:=g^k\)</span>.</li>
<li>The verifier chooses and sends uniform <span class="math inline">\(\alpha,r\in \mathbb{Z}_{q}\)</span> as the challenge.</li>
<li>The prover sends <span class="math inline">\(s:=[k^{-1}\cdot (\alpha + xr)~mod~q]\)</span> as the response.</li>
<li>The verifier accepts if <span class="math inline">\(s\ne 0\)</span> and <span class="math inline">\(g^{\alpha s^{-1}}\cdot y^{rs^{-1}}=I\)</span>.</li>
</ul>
<p>The DSA/ECDSA signature scheme are constructed by "collapsing" the above idnetification scheme into a non-interactive algorithm in <em>a different way from Fiat-Shamir transform</em>. The construction is as follows:</p>
<ul>
<li><span class="math inline">\(Gen\)</span>: on input <span class="math inline">\(1^n\)</span>, run <span class="math inline">\(\mathcal{G}(1^{n})\)</span> to obtain <span class="math inline">\((\mathbb{G},q,g)\)</span>. Choose uniform <span class="math inline">\(x\in \mathbb{Z}_q\)</span> and set <span class="math inline">\(y:=g^x\)</span>. The public key is <span class="math inline">\(&lt;\mathbb{G},q,g,y&gt;\)</span> and the private key is <span class="math inline">\(x\)</span>. Also generate two functions <span class="math inline">\(H:\{0,1\}^{*}\rightarrow \mathbb{Z}_q\)</span> and <span class="math inline">\(F:\mathbb{G}\rightarrow \mathbb{Z}_q\)</span>.</li>
<li><span class="math inline">\(Sign\)</span>: on input the private key <span class="math inline">\(x\)</span> and a message <span class="math inline">\(m\in \{0,1\}^*\)</span>, choose uniform <span class="math inline">\(k\in \mathbb{Z}_{q}^{*}\)</span> and set <span class="math inline">\(r:=F(g^{k})\)</span>. Then compute <span class="math inline">\(s:=[k^{-1}\cdot (H(m)+xr)~mod~q]\)</span>. (if <span class="math inline">\(r=0\)</span> or <span class="math inline">\(s=0\)</span> just start again with a new <span class="math inline">\(k\)</span>). Output the signature <span class="math inline">\((r,s)\)</span>.</li>
<li><span class="math inline">\(Vrfy\)</span>: on input a public key <span class="math inline">\(&lt;\mathbb{G},q,g,y&gt;\)</span>, a message <span class="math inline">\(m\in \{0,1\}^*\)</span>, and a signature <span class="math inline">\((r,s)\)</span> with <span class="math inline">\(r,s\ne 0~mod~q\)</span>, output 1 if and only if <span class="math inline">\(r=F(g^{H(m)\cdot s^{-1}}y^{r\cdot s^{-1}})\)</span>.</li>
</ul>
<p>The function <span class="math inline">\(H\)</span> is a cryptographic hash function; the function <span class="math inline">\(F\)</span> depends on the group <span class="math inline">\(\mathbb{G}_m\)</span>, which in DSA is defined as <span class="math inline">\(F(I)=[I~mod~q]\)</span>, and is defined as <span class="math inline">\(F((x,y))=[x~mod~q]\)</span> in ECDSA. Also pay attention that the signer should choose a uniform <span class="math inline">\(k\in \mathbb{Z}_q^{*}\)</span> when computing a signature.</p>
<h1 id="certificates-and-public-key-infrastructures">Certificates and public-key infrastructures</h1>
<h2 id="certificates">Certificates</h2>
<h3 id="definition">Definition</h3>
<p>In concrete, assuming a party Charlie has generated a key-pair <span class="math inline">\((pk_{C},sk_{C})\)</span> for a secure digital signature scheme. Further another party Bob has also generated a key-pair <span class="math inline">\((pk_{B},sk_{B})\)</span> and Charlie knows that <span class="math inline">\(pk_B\)</span> is Bob's public key. Then Charlie can compute the signature <span class="math inline">\(cert_{C\rightarrow B}=Sign_{sk_{C}}(\mathrm{&#39;Bob&#39;s~key~is~} pk_{B}\mathrm{&#39;})\)</span> and give this signature to Bob. <span class="math inline">\(cert_{C\rightarrow B}\)</span> is called a certificate for Bob's key issued by Charlie.</p>
<p>When Bob wants to communicate with some other party Alice who already knows <span class="math inline">\(pk_C\)</span>, Bob can send <span class="math inline">\((pk_{B},cert_{C\rightarrow B})\)</span> to Alice, who can then verify that <span class="math inline">\(cert_{C\rightarrow B}\)</span> is indeed a valid signature on the message "Bob's key is <span class="math inline">\(pk_{B}\)</span>" with respect to <span class="math inline">\(pk_{C}\)</span>. If verification succeeds, and Alice trusts Charlie, she can accept <span class="math inline">\(pk_B\)</span> as Bob's legitimate public key. Note that all the communication between Bob and Alice can occur over an <em>insecure and unauthenticated</em> channel.</p>
<h3 id="details-of-a-certificate">Details of a certificate</h3>
<p>Looking at the details of the certificate in Windows OS or Firefox Browser, we can see the digital certificate contains the following elements:</p>
<ul>
<li>Certificate
<ul>
<li>Version: the version of the digital certificate. (X.509 v1, X.509 v2, X.509 v3)</li>
<li>Serial number: each certificate has a unique serial number.</li>
<li>Valid from: the certificate is not valid before that time.</li>
<li>Valid to: the certificate is not valid after that time.</li>
<li>Issued to (subject): the owner information of the certificate, including the name of owner, public key, etc.</li>
<li>Issued by (Issuer): whom this certificate is signed by (the root CAs are themselves).</li>
<li>Extensions: key usage, constraints, etc.</li>
</ul></li>
<li>Certificate signature algorithm: hash algorithm &amp; public-key encryption algorithm.</li>
<li>Certificate fingerprint: the encrypted hash value of the certificate, which is used to check the integrity of the certificate. (How the hash value is calculated: TBSCertificate content of the certificate. See https://stackoverflow.com/questions/12645128/certificate-hash-checking)</li>
</ul>
<h2 id="public-key-infrastructure-pki">Public-key infrastructure (PKI)</h2>
<h3 id="types">Types</h3>
<p>The Public-key infrastructure (PKI) enables the widespread distribution of public keys. Some types of PKI are described as follows:</p>
<ul>
<li><strong>A single certificate authority</strong>. The simplest PKI assumes a single certificate authority (CA) who is completely trusted by everybody and who issues certificates for everyone's public key. Anyone who wants to rely on the services of the CA would have to obtain a legitimate copy of the CA's public key <span class="math inline">\(pk_{CA}\)</span>. This step must be carried out in a secure fashion, i.e., <span class="math inline">\(pk_{CA}\)</span> must be distributed over an authenticated channel (e.g. via physical means like USB, bundle the public key with softwares). Only one CA is not very practical: it is unlikely for everyone to trust the same CA, the CA is a single point of failure for the entire system, it is inconvenient for all parties to have to contact only one CA, etc.</li>
<li><strong>Multiple certificate authorities</strong>. A party Bob who wants to obtain a certificate can choose which CA(s) he wants to issue a certificate. And a party Alice, who is presented with multiple certificates, can choose which CA's certificates she trusts. In this way, the security of Alice's communication is ultimately only as good as the least-secure CA she trusts.</li>
<li><strong>Delegation and certificate chains</strong>. Certificate chains can alleviate the burden on a single CA, but add more points of attack in the system. Say Charlie who acting as a CA issues a certificate <span class="math inline">\(cert_{C\rightarrow B}\)</span>for Bob, and trust him to issue other certificates at the same time. Then, Bob can issue a certificate <span class="math inline">\(cert_{B\rightarrow A}\)</span> for Alice. When Alice wants to communicate with Dave who knows <span class="math inline">\(pk_{C}\)</span>, she can send <span class="math inline">\(pk_{A},cert_{B\rightarrow A},pk_{B},cert_{C\rightarrow B}\)</span> to Dave. If Dave trusts Charlie to issue certificates only to trustworthy people, then Dave may accept <span class="math inline">\(pk_A\)</span> (need to certificate recursively). We say that Charlie is, in effect, delegating his ability to issue certificates to Bob.</li>
<li><strong>The "web of trust" model</strong>. This model is a fully distributed model with no central points of trust. In this model, anyone can issue certificates to anyone else, and each user has to make their own decision about how much trust to place in certificates issued by other users. So users need to collect both public keys of other parties and certificates on their own public key. This model might work well for users encrypting their email, but it is not appropriate for settings where security is more critical or for the distribution of organizational public keys.</li>
</ul>
<h3 id="pki-in-practice">PKI in practice</h3>
<p>In practice, there are many root CAs in different countries, whose certificates validate themselves. And each CA will delegate their authority to some trust entities. For users, they have a certification database enlisting the trusted CAs. E.g., the certification database in Windows OS containing their expiration date, encryption algorithm, public key and so on, as the following figure shows.</p>
<figure>
<img data-src="https://raw.githubusercontent.com/lyf35/blog_figures/main/img/20201105002930.png" alt="image-20201020000144220" /><figcaption aria-hidden="true">image-20201020000144220</figcaption>
</figure>
<p>The things described above form a disclosure of the certification chain. A simple example of certification scheme is shown as the following illustrations:</p>
<figure>
<img data-src="https://raw.githubusercontent.com/lyf35/blog_figures/main/img/20201105002923.png" alt="image-20201020000253137" /><figcaption aria-hidden="true">image-20201020000253137</figcaption>
</figure>
<p>For Windows OS, the trust CAs could be preinstalled in the OS to ensure its security. Some softwares may also include their own CAs. For flexibility, CA could also be installed manually, but this could be dangerous. In some other situations, the trust CAs might be written into chips directly, or they might be installed from hardware.</p>
<h2 id="invalidating-certificates">Invalidating certificates</h2>
<p>The certificates should generally not be valid indefinitely. In some scenerios, we need a way to render previously issued certificates invalid.</p>
<ul>
<li><strong>Expiration</strong>. One method is to include an expiry date as part of the certificate. But this is a very corase-grained solution.</li>
<li><strong>Revocation</strong>. The CA can explicit revoke the certificate to make certificates become invalid as soon as possible. One way is to include a unique serial number in every certificate. And the CA needs to widely distribute a signed certificate revocation list (CRL) with the serial number of all revoked certificates and current date.</li>
</ul>
<h1 id="ssltls">SSL/TLS</h1>
<h2 id="overview-1">Overview</h2>
<p>Say two people, Alice and Bob, want to communicate with each other in a public and unauthenticated channel. Both of them have certificates from the same root CA. The communication between them can use each other's public key to encrypt and use their own private key for signature, after sending and checking the certificates in advance. But this way could be time-consuming, and getting a certificate might be difficult sometimes. TLS/SSL offers a way to solve the two problems.</p>
<p>TLS is the protocol used by the browser any time when connect to a website using <code>https</code> rather than <code>http</code>. It is a standardized protocol based on a precursor called SSL (Secure Socket Layer).</p>
<p>The requirement of certificates differ from applications. In HTTPS and FTPS protocol, only the certificate of the server is required (one-way verification). And for some more straight situations like Web banking, the certificates from both sides are required (mutual verification).</p>
<p>TLS allows a client and a server to agree on a set of shared keys and then to use those keys to encrypt and authenticate their subsequent communications. It consists two parts: a <em>handshake protocol</em> that performs authenticated key exchange to establish the shared keys, and a <em>record-layer protocol</em> that uses those shared keys to encrypt/authenticate the parties' communication.</p>
<h2 id="the-hand-shake-protocol">The hand-shake protocol</h2>
<p>At the outset of the protocol, the client <span class="math inline">\(C\)</span> holds a set of CA's public keys <span class="math inline">\({pk_{1},\dots,pk_{n}}\)</span>, and the server <span class="math inline">\(S\)</span> has a key-pair <span class="math inline">\((pk_{S},sk_{S})\)</span> for a KEM along with a certificate <span class="math inline">\(cert_{i\rightarrow S}\)</span> issued by one of the CAs whose public key <span class="math inline">\(C\)</span> knows. To connect to <span class="math inline">\(S\)</span>, the parties run the following steps:</p>
<ul>
<li><span class="math inline">\(C\)</span> begins by sending a message to <span class="math inline">\(S\)</span> that includes information about the versions of the protocol supported by the client, the ciphersuites supported by the client (the hash functions or block ciphers the client allows) and a uniform value <span class="math inline">\(N_{C}\)</span>.</li>
<li><span class="math inline">\(S\)</span> responds by selecting the latest version of the protocol it supports as well as an appropriate ciphersuite. It also sends its public key <span class="math inline">\(pk_{S}\)</span>, its certificate <span class="math inline">\(cert_{i\rightarrow S}\)</span> and its own uniform value <span class="math inline">\(N_{S}\)</span>.</li>
<li><span class="math inline">\(C\)</span> checks whether one of the CA's public keys <span class="math inline">\(pk_i\)</span> matches the CA who issued <span class="math inline">\(S\)</span>'s certificate, also checks whether it has not expired or been revoked. If so, <span class="math inline">\(C\)</span> verifies the certificate and learns that <span class="math inline">\(pk_{S}\)</span> is <span class="math inline">\(S\)</span>'s public key. Then it runs <span class="math inline">\((c,pmk)\leftarrow Encaps_{pk_{S}}(1^{n})\)</span> to obtain a ciphertext <span class="math inline">\(c\)</span> and a so-called pre-master key <span class="math inline">\(pmk\)</span> (used to derive a master key <span class="math inline">\(mk\)</span> using a key-derivation function applied to <span class="math inline">\(pmk,~N_{C} ~\textrm{and}~N_{S}\)</span>, which is then used by the client in a pseudorandom generator to derive four keys <span class="math inline">\(k_{C},k_{C}^{&#39;},k_{S},k_{S}^{&#39;}\)</span>) and then send <span class="math inline">\(c\)</span> to the server. Finally, <span class="math inline">\(C\)</span> computes <span class="math inline">\(\tau_{C}\leftarrow Mac_{mk}(transcript)\)</span>, where <span class="math inline">\(transcript\)</span> denotes all messages exchanged between <span class="math inline">\(C\)</span> and <span class="math inline">\(S\)</span> thus far, and send <span class="math inline">\(\tau_{C}\)</span> to <span class="math inline">\(S\)</span>.</li>
<li><span class="math inline">\(S\)</span> computes <span class="math inline">\(pmk:=Decaps_{sk_{S}}(c)\)</span>, from which it can derive <span class="math inline">\(mk\)</span> and <span class="math inline">\(k_{C},k_{C}^{&#39;},k_{S},k_{S}^{&#39;}\)</span> as the client did. If <span class="math inline">\(Vrfy_{mk}(transcript,\tau_{C})\ne 1\)</span>, then <span class="math inline">\(S\)</span> aborts (If this happen, choose a uniform <span class="math inline">\(pmk\)</span> and continue running using that value, which can prevent Bleichenbacher-style attacks). Otherwise, it sets <span class="math inline">\(\tau_{S}\leftarrow Mac_{mk}(transcript&#39;)\)</span>, where <span class="math inline">\(transcript&#39;\)</span> denotes all the messages exchanged between <span class="math inline">\(C\)</span> and <span class="math inline">\(S\)</span> thus far. Then <span class="math inline">\(S\)</span> sends <span class="math inline">\(\tau_{S}\)</span> to <span class="math inline">\(C\)</span>.</li>
<li>If <span class="math inline">\(Vrfy_{mk}(transcript&#39;,\tau_{S})\ne 1\)</span>, the client aborts.</li>
</ul>
<p>At the end of a successful executin of the handshake protocol, <span class="math inline">\(C\)</span> and <span class="math inline">\(S\)</span> share a set of four symmetric keys <span class="math inline">\(k_{C},k_{C}^{&#39;},k_{S},k_{S}^{&#39;}\)</span>.</p>
<p>TLS 1.2 supports two KEMs: a CDH/DDH-based KEM, or the RSA-based encryption scheme PKCS #1 v1.5.</p>
<p>For situations need mutual verification, the handshake process is similar, except that the server will also check the identity of the user before sharing the symmetric key.</p>
<p>The following is an illustration of SSL handshake process:</p>
<figure>
<img data-src="https://raw.githubusercontent.com/lyf35/blog_figures/main/img/20201105002916.png" alt="image-20201020001109274" /><figcaption aria-hidden="true">image-20201020001109274</figcaption>
</figure>
<h2 id="the-record-layer-protocol">The record-layer protocol</h2>
<p>once keys have been agreed upon by <span class="math inline">\(C\)</span> and <span class="math inline">\(S\)</span>, the parties use those keys to encrypt and authenticate all their subsequent communication. <span class="math inline">\(C\)</span> uses <span class="math inline">\(k_{C}\)</span> to encrypt and <span class="math inline">\(k_{C}^{&#39;}\)</span> to authenticate all messages it sends to <span class="math inline">\(S\)</span>; <span class="math inline">\(S\)</span> uses <span class="math inline">\(k_{S}\)</span> and <span class="math inline">\(k_{S}^{&#39;}\)</span> to encrypt and authenticate all the messages it sends. Sequence numbers are used to prevent replay attacks.</p>
<h2 id="pseudocode">Pseudocode</h2>
<h3 id="client">Client</h3>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//construct communication with server</span></span><br><span class="line">server = <span class="built_in">socket_init</span>()</span><br><span class="line"><span class="keyword">while</span> (!server)</span><br><span class="line">    <span class="built_in">connect</span>(server, server_address);</span><br><span class="line"></span><br><span class="line"><span class="comment">//handshake process</span></span><br><span class="line">buffer=[]</span><br><span class="line">server.<span class="built_in">send</span>(<span class="string">&#x27;Protocol version&#x27;</span>, <span class="string">&#x27;Ciphersuites&#x27;</span>, N_c = <span class="built_in">random</span>()); <span class="comment">//send information to server</span></span><br><span class="line">buffer.<span class="built_in">push_back</span>(server.last_sent_message);</span><br><span class="line"><span class="string">&#x27;Protocol version&#x27;</span>, <span class="string">&#x27;Ciphersuites&#x27;</span>, pk, Certificate, N_s = server.<span class="built_in">receive</span>(); <span class="comment">//get information from server</span></span><br><span class="line">buffer.<span class="built_in">push_back</span>(server.last_received_message);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">Check_certificate</span>(pk, certificate) != <span class="number">1</span>) <span class="comment">//check the validity of certificate</span></span><br><span class="line">    server.<span class="built_in">disconnect</span>();</span><br><span class="line">    <span class="keyword">return</span> error;</span><br><span class="line">(c, pmk) = <span class="built_in">Encaps</span>(pk, <span class="number">1</span>^n); <span class="comment">//generate pre-master key</span></span><br><span class="line">mk = <span class="built_in">Key_derivation</span>(pmk, N_c, N_s); <span class="comment">//generate masker key</span></span><br><span class="line">tau_c = <span class="built_in">Mac</span>(mk, buffer); <span class="comment">//transcript denotes all the messages exchanged above </span></span><br><span class="line">server.<span class="built_in">send</span>((c, tau_c)); <span class="comment">//send message to server</span></span><br><span class="line">buffer.<span class="built_in">push_back</span>(server.last_sent_message);</span><br><span class="line">server.<span class="built_in">receive</span>(tau_s);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">Vrfy</span>(mk, transcript_new, tau_s) != <span class="number">1</span>)</span><br><span class="line">    server.<span class="built_in">disconnect</span>();</span><br><span class="line">    <span class="keyword">return</span> error;</span><br><span class="line">k_c, k_c2, k_s, k_s2 = <span class="built_in">random</span>(mk);</span><br><span class="line"></span><br><span class="line"><span class="comment">//communication</span></span><br><span class="line">cnt_client = <span class="number">0</span>;</span><br><span class="line">cnt_server = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">input</span>(send_messages))</span><br><span class="line">        server.<span class="built_in">send</span>(<span class="built_in">Encrypt</span>(k_c, send_messages) + <span class="built_in">MAC</span>(k_c2, send_messages, cnt_client));</span><br><span class="line">        cnt_client++;</span><br><span class="line">    <span class="keyword">if</span>(server.<span class="built_in">receive</span>(received_messages))</span><br><span class="line">        received_messages_encrypted, MAC_str=<span class="built_in">split</span>(received_messages)</span><br><span class="line">        received_messages_decrypted = <span class="built_in">Decrypt</span>(k_s, received_messages_encrypted)</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">Vrfy</span>(k_s2, received_messages_decrypted, cnt_server, MAC_str) != <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> error;</span><br><span class="line">        cnt_server++;</span><br></pre></td></tr></table></figure>
<h3 id="server">Server</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//construct connection with client</span></span><br><span class="line">client = <span class="built_in">socket_init</span>();</span><br><span class="line"><span class="keyword">while</span>(!client)</span><br><span class="line">    <span class="built_in">listen</span>(client);</span><br><span class="line"></span><br><span class="line"><span class="comment">//handshake process</span></span><br><span class="line">buffer=[]</span><br><span class="line"><span class="string">&#x27;Protocol version&#x27;</span>, <span class="string">&#x27;ciphersuites&#x27;</span>, N_c = client.<span class="built_in">receive</span>()</span><br><span class="line">buffer.<span class="built_in">push_back</span>(client.last_received_message)</span><br><span class="line">client.<span class="built_in">send</span>(<span class="string">&#x27;Protocol version&#x27;</span>, <span class="string">&#x27;ciphersuites&#x27;</span>, pk, certificate, N_s=<span class="built_in">rand</span>())</span><br><span class="line">buffer.<span class="built_in">push_back</span>(client.last_sent_message)</span><br><span class="line">c, tau_c = client.<span class="built_in">receive</span>()</span><br><span class="line">buffer.<span class="built_in">push_back</span>(client.last_received_message)</span><br><span class="line">pmk = <span class="built_in">Decap</span>(sk, c)</span><br><span class="line">mk = <span class="built_in">Key_derivation</span>(pmk, N_c, N_s) <span class="comment">//generate masker key</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">Vrfy</span>(mk, transcript, tau_c) != <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> error;</span><br><span class="line">tau_s = <span class="built_in">Mac</span>(mk, buffer);</span><br><span class="line">client.<span class="built_in">send</span>(tau_s);</span><br><span class="line">k_c, k_c2, k_s, k_s2 = <span class="built_in">random</span>(mk);</span><br><span class="line"></span><br><span class="line"><span class="comment">//communication</span></span><br><span class="line">cnt_client = <span class="number">0</span>;</span><br><span class="line">cnt_server = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">input</span>(send_messages))</span><br><span class="line">        client.<span class="built_in">send</span>(<span class="built_in">Encrypt</span>(k_s, send_messages) + <span class="built_in">MAC</span>(k_s2, send_messages, cnt_server));</span><br><span class="line">        cnt_server++;</span><br><span class="line">    <span class="keyword">if</span>(server.<span class="built_in">receive</span>(received_messages))</span><br><span class="line">        received_messages_encrypted, MAC_str=<span class="built_in">split</span>(received_messages)</span><br><span class="line">        received_messages_decrypted = <span class="built_in">Decrypt</span>(k_c, received_messages_encrypted)</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">Vrfy</span>(k_c2, received_messages_decrypted, cnt_server, MAC_str) != <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> error;</span><br><span class="line">        cnt_client++;</span><br></pre></td></tr></table></figure>
<h1 id="references">References</h1>
<ol type="1">
<li>https://www.zhihu.com/question/22260090/answer/648910720</li>
<li>Jonathan Katz, Yehuda Lindell. Introduction to Modern Cryptography, Second Edition.</li>
<li>https://zhuanlan.zhihu.com/p/34322643</li>
<li>https://blog.csdn.net/carolzhang8406/article/details/79458206</li>
<li>https://www.jianshu.com/p/df935a45c7e0</li>
<li>https://blog.csdn.net/adeyi/article/details/8556170</li>
<li>https://www.zhihu.com/question/24294477</li>
<li>https://www.cnblogs.com/JeffreySun/archive/2010/06/24/1627247.html</li>
<li>https://blog.csdn.net/dcz1001/article/details/22192655</li>
<li>https://www.cnblogs.com/jifeng/archive/2010/11/30/1891779.html</li>
</ol>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Yufei Luo
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://lyf35.github.io/2020/09/10/%E5%AF%86%E7%A0%81%E5%AD%A6-%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/" title="密码学-数字签名">http://lyf35.github.io/2020/09/10/密码学-数字签名/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/" rel="tag"><i class="fa fa-tag"></i> 信息安全</a>
              <a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" rel="tag"><i class="fa fa-tag"></i> 密码学</a>
              <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" rel="tag"><i class="fa fa-tag"></i> 计算机基础</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/08/30/%E5%AF%86%E7%A0%81%E5%AD%A6-%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86/" rel="prev" title="密码学-公钥加密">
      <i class="fa fa-chevron-left"></i> 密码学-公钥加密
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/09/17/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%9C%BA%E5%99%A8%E7%BA%A7%E8%A1%A8%E7%A4%BA/" rel="next" title="计算机组成原理-程序的机器级表示">
      计算机组成原理-程序的机器级表示 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yufei Luo</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">1.5m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">22:56</span>
</div>
  <div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl theme-link" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9waXNjZXMv">NexT.Pisces</span> 强力驱动
  </div>

        






<script data-pjax>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      const visitors = document.querySelector('.leancloud_visitors');
      const url = decodeURI(visitors.id);
      const title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            const counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      const visitors = document.querySelectorAll('.leancloud_visitors');
      const entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"ypNNXSdcGIIoldC5BBmViS2g-gzGzoHsz","app_key":"0TDwohU7eO4yHTn4tley8PtE","server_url":"https://leancloud.cn/dashboard/data.html?appid=ypNNXSdcGIIoldC5BBmViS2g-gzGzoHsz#/","security":false};
    function fetchData(api_server) {
      const Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    const api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="//cdn.jsdelivr.net/npm/ribbon.js@1/dist/ribbon.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/next-theme/pjax@0/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script>


  
  <script data-pjax>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="/js/local-search.js"></script>









<script data-pjax>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script data-pjax>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.init({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    }, '.mermaid');
  }, window.mermaid);
}
</script>


    <div class="pjax">
  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      const script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments('#gitalk-container', () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '4dcdc02d24075b0e9d3a',
      clientSecret: '53cf2cb8b89b9d4bba922bb19bda1290f0d0bf95',
      repo        : 'lyf35.github.io',
      owner       : 'lyf35',
      admin       : ['lyf35'],
      id          : 'bff5b12cd4bae8a1f2791628d261dd09',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

    </div>
</body>
</html>
